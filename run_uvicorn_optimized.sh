#!/bin/zsh

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# Script para ejecutar el servidor con Uvicorn optimizado para mรกxima velocidad
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

cd /Users/santiagobuitragorojas/Documents/Intrasoft/Repos/daniel-quintero-repos/Refactor/chatbot-ai-service-multitenant

# Activar entorno virtual
source venv/bin/activate

# Cargar variables de entorno desde .env
set -a
source .env
set +a

# Configurar PYTHONPATH
PYTHONPATH="$(pwd)/src/main/python"
export PYTHONPATH

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ๐ FEATURE FLAGS para mรกxima velocidad
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
USE_GEMINI_CLIENT=true
export USE_GEMINI_CLIENT

USE_ADVANCED_MODEL_CONFIGS=true
export USE_ADVANCED_MODEL_CONFIGS

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ๐ Ejecutar servidor con Uvicorn optimizado
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "๐ INICIANDO CHATBOT AI SERVICE - Uvicorn Optimizado"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "๐ PYTHONPATH: $PYTHONPATH"
echo ""
echo "๐ฏ FEATURE FLAGS:"
echo "   โ USE_GEMINI_CLIENT: $USE_GEMINI_CLIENT"
echo "   โ USE_ADVANCED_MODEL_CONFIGS: $USE_ADVANCED_MODEL_CONFIGS"
echo ""
echo "๐ง SERVICIOS:"
echo "   ๐ CONFIG SERVICE: $POLITICAL_REFERRALS_SERVICE_URL"
echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "๐ฎ Servidor arrancando con Uvicorn optimizado..."
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

# Usar Uvicorn con configuraciรณn optimizada para mรกxima velocidad
python -m uvicorn chatbot_ai_service.main:app \
    --host 0.0.0.0 \
    --port 8000 \
    --workers 1 \
    --loop uvloop \
    --http httptools \
    --access-log \
    --log-level info \
    --timeout-keep-alive 30 \
    --timeout-graceful-shutdown 10 \
    --limit-concurrency 1000 \
    --limit-max-requests 10000 \
    --backlog 2048
